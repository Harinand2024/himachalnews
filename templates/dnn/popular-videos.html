{% load static %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<style>
.popular-video {
    max-width: 420px;
}
/* Main video */
.popular-video .main-video {
    position: relative;
    margin-bottom: 10px;
}
.popular-video .main-video img {
    width: 100%;
    display: block;
    border-radius: 4px;
}
.popular-video .main-video .play-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 30px;
    color: white;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    padding: 14px 23px;
    cursor: pointer;
    width: 80px;
    height: 80px;
}
/* Thumbnails slider */
.swiper {
    width: 100%;
}
.custom-slide {
    position: relative;
    width: 100px !important;
    height: 100px !important;
    margin: 0 5px !important;
    cursor: pointer;
}
.custom-slide img {
    width: 100%;
    border-radius: 4px;
    display: block;
    object-fit: cover;
}
.custom-slide .play-btn {
    position: absolute;
    top: 35%;
    left: 45%;
    transform: translate(-50%, -50%);
    font-size: 16px;
    color: white;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 48%;
    padding: 5px 9px;
    cursor: pointer;
    width: 30px;
    height: 30px;
}
</style>

<div class="popular-video">
    <!-- Main Video -->
    <div class="main-video" id="mainVideoContainer">
        {% if videos %}
        <iframe 
            id="mainVideo" 
            width="100%" 
            height="250" 
            src="https://www.youtube.com/embed/{{ videos.0.video_url }}?autoplay=1&mute=1&rel=0" 
            title="{{ videos.0.video_title }}" 
            frameborder="0" 
            allow="autoplay; encrypted-media" 
            allowfullscreen
            loading="lazy">
        </iframe>
        {% endif %}
    </div>

    <!-- Thumbnail Slider -->
    <div class="swiper mySwiper">
        <div class="swiper-wrapper">
            {% for CatVid in videos %}
            <div class="swiper-slide custom-slide">
                <a href="javascript:void(0);" 
                   class="thumb-video" 
                   data-video="{{ CatVid.video_url }}" 
                   data-title="{{ CatVid.video_title }}">
                    <img src="https://img.youtube.com/vi/{{ CatVid.video_url }}/hqdefault.jpg"
                         alt="{{ CatVid.video_title }}"
                         title="{{ CatVid.video_title }}"
                         loading="lazy">
                    <div class="play-btn">&#9658;</div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 1) Swiper setup with autoplay
    var swiper = new Swiper(".mySwiper", {
      slidesPerView: 3,
      spaceBetween: 5,
      loop: true,
      autoplay: {
        delay: 3000,
        disableOnInteraction: false
      },
      slideToClickedSlide: true,
      watchSlidesProgress: true,
      on: {
        // 2) Click on any slide (including loop clones)
        click: function (sw, event) {
          const slideEl = sw.clickedSlide;
          if (!slideEl) return;

          const anchor = slideEl.querySelector(".thumb-video");
          if (!anchor) return;

          event && event.preventDefault();
          changeMainVideo(anchor.dataset.video, anchor.dataset.title);
        }
      }
    });

    // Helper: escape title
    function esc(s) {
      return String(s).replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[c]));
    }

    // 3) Update main video iframe
    function changeMainVideo(videoId, videoTitle) {
      const container = document.getElementById("mainVideoContainer");
      if (!container) return;

      container.innerHTML = `
        <iframe
          width="100%"
          height="250"
          src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0"
          title="${esc(videoTitle)}"
          frameborder="0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen
        ></iframe>
      `;
    }

    // 4) Fallback: if someone clicks directly on the inner elements
    document.addEventListener("click", function (e) {
      const el = e.target.closest(".thumb-video");
      if (!el) return;
      e.preventDefault();
      changeMainVideo(el.dataset.video, el.dataset.title);
    });
  });
</script>



